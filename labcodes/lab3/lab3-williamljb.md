# lab3 报告

## 练习题
### 练习一 给未被映射的地址映射上物理页
---

实现过程：在do_pgfault中，根据页异常出现的页目录表地址和所访问的地址，寻找它所在的页表项。
如果这个页表项对应的物理页不存在，说明这个页还没有被生成，所以需要生成一个页，然后把页表项指向它。

页表项中有一些位标明了这个页是否被修改过或者是否在最近被访问过，这个对clock页替换算法是必需的。

硬件需要保存缺页服务例程的现场，然后产生缺页中断，查找相应的IDT和GDT，再返回缺页服务例程处理缺页异常。

---

### 练习二 补充完成基于FIFO的页面替换算法
---

实现过程：在do_pgfault中，根据页异常出现的页目录表地址和所访问的地址，寻找它所在的页表项。
如果这个页表项对应的物理页存在，那么就是说它目前被放在外存中，所以要把它放进来。
swap进来之后，把物理地址和虚拟地址进行映射，再设置这个页为可被替换的即可。
在swap_manager处，需要维护一个访问队列。首先需要注意的是队列的初始化中，该队列头是非法的，即没有对应一个有效页。
在插入一个页面的时候，把它放在队尾（添加在头的前面），在弹出一个页面的时候，弹出队头的下一个即可。
需要注意的是，这里并没有显式调用swapout函数，估计是在分配一个页的时候，会自动检测内存是否已满，如果满了的话再去尝试swapout。

如果要实现extended clock算法，需要知道每个页是否被修改过和访问过。这些在页表项中已经有对应位（PTE_A，PTE_D）了。
所以只需要在fifo中的swapout修改一下，变成循环遍历队列，找到第一个标记为00的页，替换掉即可。换入换出的时机可以和FIFO的一样。

---

---


### 重要的知识点
---

实验中碰到的一个情况是某个页表项没有对应任何物理页，这个没有在原理课上讲到。
原理课上的LRU算法，工作集置换算法和缺页率算法没有在实验中得到体现。

---

